# Pricing Documentation

Complete pricing strategy, tier specifications, and monetization plan for Shortly.

---

## ğŸ“‹ Table of Contents

1. [Pricing Overview](#pricing-overview)
2. [Pricing Tiers](#pricing-tiers)
3. [Feature Comparison Matrix](#feature-comparison-matrix)
4. [Premium Features](#premium-features)
5. [Implementation Guide](#implementation-guide)
6. [Competitive Analysis](#competitive-analysis)
7. [Monetization Strategy](#monetization-strategy)
8. [Technical Requirements](#technical-requirements)
9. [Growth & Marketing](#growth--marketing)
10. [FAQ](#faq)

---

## ğŸ¯ Pricing Overview

Shortly's pricing strategy is designed to:

- **Attract users** with a generous free tier
- **Convert effectively** through feature-based upgrades
- **Scale sustainably** with usage-based limits
- **Compete strategically** against Bitly, Rebrandly, and TinyURL
- **Serve all segments** from individuals to enterprises

### Pricing Philosophy

1. **Free tier is functional**: Users can accomplish real work without paying
2. **Value over limits**: Upgrades unlock features, not just higher numbers
3. **Transparent pricing**: No hidden fees, clear limits, simple billing
4. **Annual incentives**: 17% discount for annual commitment (2 months free)
5. **Usage-based fairness**: Pay for what you use, scale as you grow

---

## ğŸ’° Pricing Tiers

### ğŸ†“ Free Tier - $0/month

**Target Audience**: Individual users, hobbyists, testing, personal projects

**Limits**:
- 25 active links maximum
- 5 custom aliases per month
- 1,000 clicks tracked per month
- 3 QR codes per month
- 30-day analytics retention
- 1 user (account owner only)

**Features**:
- âœ… Link shortening with auto-generated codes
- âœ… Custom aliases (limited)
- âœ… Basic click tracking
- âœ… Dashboard access
- âœ… Standard QR code generation
- âœ… 30-day analytics history
- âœ… Basic analytics (total clicks, recent activity)
- âœ… Link expiration scheduling
- âœ… Link activation scheduling
- âœ… Link status toggle (active/inactive)
- âœ… Export links to CSV
- âœ… Community support (documentation, forums)

**Use Cases**:
- Personal link sharing
- Social media profiles
- Testing the platform
- Small-scale projects
- Learning and exploration

**Upgrade Triggers**:
- Need more than 25 links
- Want unlimited custom aliases
- Require advanced analytics
- Need longer analytics retention
- Want team collaboration

---

### ğŸš€ Starter Tier - $9/month or $90/year

**Target Audience**: Freelancers, content creators, small businesses, marketers

**Limits**:
- 200 active links
- Unlimited custom aliases
- 10,000 clicks tracked per month
- 25 QR codes per month
- 90-day analytics retention
- 1 user (account owner only)

**Features**:
- âœ… Everything in Free, plus:
- âœ… **Unlimited custom aliases** (your brand, your way)
- âœ… **Advanced analytics** (referrer sources, device types, locations)
- âœ… **Bulk link import** (CSV upload for multiple links)
- âœ… **Extended analytics** (90-day retention vs 30-day)
- âœ… **Custom expiration messages** (personalize expired link pages)
- âœ… **Link notes & descriptions** (organize your links)
- âœ… **Enhanced export** (CSV with full analytics data)
- âœ… **Email support** (24-48 hour response time)
- âœ… **Priority link creation** (faster processing)
- âœ… **No "Powered by Shortly" branding** on QR codes

**Use Cases**:
- Freelance marketing campaigns
- Content creator link trees
- Small business promotions
- Newsletter link tracking
- Social media management

**Upgrade Triggers**:
- Need custom domain branding
- Want branded QR codes
- Require A/B testing
- Need team collaboration
- Want API access

**Annual Savings**: Save $18/year (2 months free)

---

### ğŸ’¼ Professional Tier - $29/month or $290/year

**Target Audience**: Growing businesses, agencies, marketing teams, developers

**Limits**:
- 1,000 active links
- Unlimited custom aliases
- 100,000 clicks tracked per month
- 100 QR codes per month
- 1-year analytics retention
- 3 team members included

**Features**:
- âœ… Everything in Starter, plus:
- âœ… **Custom domains** (1 domain, e.g., go.yourbrand.com)
- âœ… **Branded QR codes** (custom colors, logo embedding)
- âœ… **A/B testing** (split traffic, track conversions)
- âœ… **Link tagging & folders** (advanced organization)
- âœ… **Team collaboration** (3 users with role permissions)
- âœ… **API access** (5,000 requests/month)
- âœ… **Webhooks** (real-time event notifications)
- âœ… **Advanced export** (JSON, Excel formats)
- âœ… **Link thumbnails** (custom Open Graph images)
- âœ… **UTM builder** (integrated campaign tracking)
- âœ… **Priority email support** (12-24 hour response time)
- âœ… **1-year analytics retention** (deep historical insights)
- âœ… **Bulk operations** (edit/delete multiple links)

**Use Cases**:
- Agency client campaigns
- Marketing team collaboration
- Developer integrations
- Multi-channel campaigns
- Brand tracking and attribution

**Upgrade Triggers**:
- Need more custom domains
- Want unlimited links
- Require SSO/SAML authentication
- Need white-label solution
- Want geographic redirects
- Require dedicated support

**Annual Savings**: Save $58/year (2 months free)

---

### ğŸ¢ Business Tier - $99/month or $990/year

**Target Audience**: Large teams, enterprises, high-volume users, agencies

**Limits**:
- âœ… **Unlimited active links**
- âœ… **Unlimited custom aliases**
- âœ… **Unlimited clicks tracked**
- âœ… **Unlimited QR codes**
- âœ… **Unlimited analytics retention**
- âœ… **10 team members included**

**Features**:
- âœ… Everything in Professional, plus:
- âœ… **Custom domains** (5 domains included)
- âœ… **White-label dashboard** (your brand, your domain)
- âœ… **SSO/SAML authentication** (enterprise identity management)
- âœ… **Advanced API access** (50,000 requests/month)
- âœ… **Geographic redirects** (different URLs by country/region)
- âœ… **Password-protected links** (secure sensitive content)
- âœ… **Link retargeting pixels** (Facebook, Google Ads integration)
- âœ… **Advanced A/B testing** (multi-variant, statistical analysis)
- âœ… **Custom link rules** (time-based, device-based redirects)
- âœ… **Dedicated account manager** (personalized onboarding & support)
- âœ… **Priority phone & chat support** (1-4 hour response time)
- âœ… **SLA guarantee** (99.9% uptime commitment)
- âœ… **Custom contract terms** (annual, multi-year agreements)
- âœ… **Advanced security** (IP whitelisting, audit logs)
- âœ… **Data residency options** (choose your data location)
- âœ… **Priority feature requests** (influence roadmap)

**Use Cases**:
- Enterprise marketing operations
- Large agency workflows
- Multi-brand management
- High-volume link generation
- Security-sensitive organizations
- Global companies

**Custom Enterprise**:
For organizations needing more than 10 team members, additional domains, or custom features, contact sales for custom pricing.

**Annual Savings**: Save $198/year (2 months free)

---

## ğŸ“Š Feature Comparison Matrix

| Feature | Free | Starter | Professional | Business |
|---------|------|---------|--------------|----------|
| **Links & Aliases** |
| Active Links | 25 | 200 | 1,000 | Unlimited |
| Custom Aliases/month | 5 | Unlimited | Unlimited | Unlimited |
| Bulk Import | âŒ | âœ… | âœ… | âœ… |
| Link Notes/Descriptions | âŒ | âœ… | âœ… | âœ… |
| Link Tagging | âŒ | âŒ | âœ… | âœ… |
| Link Folders/Organization | âŒ | âŒ | âœ… | âœ… |
| **Analytics & Tracking** |
| Clicks Tracked/month | 1,000 | 10,000 | 100,000 | Unlimited |
| Analytics Retention | 30 days | 90 days | 1 year | Unlimited |
| Basic Analytics | âœ… | âœ… | âœ… | âœ… |
| Advanced Analytics | âŒ | âœ… | âœ… | âœ… |
| Referrer Tracking | âŒ | âœ… | âœ… | âœ… |
| Device Detection | âŒ | âœ… | âœ… | âœ… |
| Geographic Analytics | âŒ | âœ… | âœ… | âœ… |
| Real-time Updates | âŒ | âŒ | âœ… | âœ… |
| **QR Codes** |
| QR Codes/month | 3 | 25 | 100 | Unlimited |
| Standard QR Codes | âœ… | âœ… | âœ… | âœ… |
| Branded QR Codes | âŒ | âŒ | âœ… | âœ… |
| Custom QR Colors | âŒ | âŒ | âœ… | âœ… |
| Logo in QR Code | âŒ | âŒ | âœ… | âœ… |
| **Advanced Features** |
| Link Expiration | âœ… | âœ… | âœ… | âœ… |
| Link Activation Scheduling | âœ… | âœ… | âœ… | âœ… |
| Custom Expiration Messages | âŒ | âœ… | âœ… | âœ… |
| A/B Testing | âŒ | âŒ | âœ… | âœ… |
| Multi-variant Testing | âŒ | âŒ | âŒ | âœ… |
| Password Protection | âŒ | âŒ | âŒ | âœ… |
| Geographic Redirects | âŒ | âŒ | âŒ | âœ… |
| Device-based Redirects | âŒ | âŒ | âŒ | âœ… |
| Retargeting Pixels | âŒ | âŒ | âŒ | âœ… |
| **Branding** |
| Custom Domains | âŒ | âŒ | 1 | 5 |
| White-label Dashboard | âŒ | âŒ | âŒ | âœ… |
| Remove "Powered by" | âŒ | âœ… | âœ… | âœ… |
| Custom Open Graph Images | âŒ | âŒ | âœ… | âœ… |
| **Team & Collaboration** |
| Users/Seats | 1 | 1 | 3 | 10 |
| Role-based Permissions | âŒ | âŒ | âœ… | âœ… |
| Team Workspaces | âŒ | âŒ | âœ… | âœ… |
| Activity Logs | âŒ | âŒ | âœ… | âœ… |
| SSO/SAML | âŒ | âŒ | âŒ | âœ… |
| **Developer Tools** |
| API Access | âŒ | âŒ | 5K/mo | 50K/mo |
| Webhooks | âŒ | âŒ | âœ… | âœ… |
| API Documentation | âŒ | âŒ | âœ… | âœ… |
| Developer Portal | âŒ | âŒ | âœ… | âœ… |
| **Export & Integrations** |
| Basic CSV Export | âœ… | âœ… | âœ… | âœ… |
| Advanced Export (JSON/Excel) | âŒ | âŒ | âœ… | âœ… |
| UTM Builder | âŒ | âŒ | âœ… | âœ… |
| Zapier Integration | âŒ | âŒ | âœ… | âœ… |
| **Support & SLA** |
| Community Support | âœ… | âœ… | âœ… | âœ… |
| Email Support | âŒ | 24-48h | 12-24h | 1-4h |
| Phone Support | âŒ | âŒ | âŒ | âœ… |
| Chat Support | âŒ | âŒ | âŒ | âœ… |
| Dedicated Account Manager | âŒ | âŒ | âŒ | âœ… |
| SLA Guarantee | âŒ | âŒ | âŒ | 99.9% |
| Priority Feature Requests | âŒ | âŒ | âŒ | âœ… |

---

## ğŸ Add-ons (Available for All Paid Tiers)

### Extra QR Codes
- **$5 per 10 QR codes** (one-time purchase, no expiration)
- Perfect for occasional campaigns
- All QR codes include tier-appropriate features

### Additional Custom Domains
- **$10/month per domain**
- Available for Professional and Business tiers
- Includes SSL certificate and DNS management
- Full branding control

### Extra Team Members
- **$9/month per additional user**
- Available for Professional and Business tiers
- Full role-based access control
- Includes all tier features

### Increased API Limits
- **Professional**: $15/month for 10,000 additional requests
- **Business**: $25/month for 25,000 additional requests
- Overage protection for high-volume months

### Extended Analytics Retention
- **$20/month for unlimited retention** (Starter/Professional only)
- Access historical data beyond tier limits
- Full export capabilities

### Priority Onboarding
- **$99 one-time fee** (Professional/Business)
- Dedicated onboarding session (1 hour)
- Custom setup and configuration
- Team training and best practices

---

## ğŸŒŸ Premium Features

### 1. Custom Domains (Professional & Business)

**What it is**: Use your own domain for short links (e.g., `go.yourbrand.com/promo`)

**Benefits**:
- Brand recognition and trust
- Consistent brand experience
- Professional appearance
- Improved click-through rates
- SEO benefits (links stay on your domain)

**Technical Implementation**:
```typescript
// Database schema
domains: {
  id: string
  userId: string
  domain: string (e.g., "go.yourbrand.com")
  verified: boolean
  sslEnabled: boolean
  createdAt: Date
  verifiedAt: Date
}

// DNS verification flow
1. User enters custom domain
2. System generates TXT record for verification
3. User adds DNS records (A/CNAME + TXT)
4. System verifies DNS propagation
5. Auto-provision SSL certificate (Let's Encrypt)
6. Enable domain for link creation
```

**Setup Process**:
1. Add domain in dashboard
2. Configure DNS records (A or CNAME)
3. Verify ownership (TXT record)
4. Wait for SSL provisioning (~5 minutes)
5. Start creating branded links

**Limits**:
- Professional: 1 domain
- Business: 5 domains
- Add-on: $10/month per additional domain

---

### 2. Branded QR Codes (Professional & Business)

**What it is**: Customizable QR codes with your brand colors and logo

**Features**:
- Custom foreground/background colors
- Logo embedding (center of QR code)
- Multiple export formats (PNG, SVG, PDF)
- High-resolution output
- Error correction levels
- Custom quiet zones

**Implementation**:
```typescript
// QR code customization options
interface BrandedQROptions {
  foregroundColor: string // Hex color
  backgroundColor: string // Hex color
  logoUrl?: string // Company logo
  logoSize: 'small' | 'medium' | 'large'
  errorCorrection: 'L' | 'M' | 'Q' | 'H'
  format: 'png' | 'svg' | 'pdf'
  size: number // Pixels
}
```

**Use Cases**:
- Marketing materials (flyers, posters)
- Product packaging
- Event badges
- Restaurant menus
- Business cards

**Best Practices**:
- Use high contrast colors
- Keep logo simple and recognizable
- Test scannability before printing
- Use higher error correction with logos

---

### 3. A/B Testing (Professional & Business)

**What it is**: Split traffic between multiple destination URLs to test performance

**Features**:
- 2-10 variants per link
- Traffic splitting (% allocation)
- Conversion tracking
- Statistical significance calculation
- Winner auto-selection
- Time-based analysis

**Implementation**:
```typescript
// A/B test configuration
interface ABTest {
  linkId: string
  variants: Array<{
    name: string
    destinationUrl: string
    trafficPercent: number
    clicks: number
    conversions: number
  }>
  conversionGoal?: string
  startDate: Date
  endDate?: Date
  status: 'active' | 'paused' | 'completed'
}
```

**Use Cases**:
- Landing page optimization
- Campaign performance testing
- Call-to-action comparison
- Pricing page variants
- Email subject line testing

**Analytics Provided**:
- Click-through rate per variant
- Conversion rate per variant
- Confidence level (95%, 99%)
- Recommended winner
- Statistical significance

---

### 4. Team Collaboration (Professional & Business)

**What it is**: Multi-user access with role-based permissions

**Roles & Permissions**:

| Permission | Owner | Admin | Editor | Viewer |
|------------|-------|-------|--------|--------|
| Create links | âœ… | âœ… | âœ… | âŒ |
| Edit links | âœ… | âœ… | âœ… | âŒ |
| Delete links | âœ… | âœ… | âŒ | âŒ |
| View analytics | âœ… | âœ… | âœ… | âœ… |
| Manage team | âœ… | âœ… | âŒ | âŒ |
| Billing | âœ… | âŒ | âŒ | âŒ |
| API keys | âœ… | âœ… | âŒ | âŒ |
| Custom domains | âœ… | âœ… | âŒ | âŒ |

**Features**:
- Email invitations
- Role assignment
- Activity logs (who did what)
- Team-wide link folders
- Shared workspaces
- Access revocation

**Implementation**:
```typescript
// Team members schema
teamMembers: {
  id: string
  teamId: string
  userId: string
  role: 'owner' | 'admin' | 'editor' | 'viewer'
  invitedBy: string
  joinedAt: Date
  lastActive: Date
}
```

---

### 5. API Access (Professional & Business)

**What it is**: Programmatic access to Shortly's features

**Endpoints**:
- `POST /api/v1/links` - Create short link
- `GET /api/v1/links` - List all links
- `GET /api/v1/links/:id` - Get link details
- `PUT /api/v1/links/:id` - Update link
- `DELETE /api/v1/links/:id` - Delete link
- `GET /api/v1/analytics/:id` - Get analytics
- `POST /api/v1/qr-codes` - Generate QR code

**Authentication**:
```bash
# API Key authentication
curl -H "Authorization: Bearer sk_live_..." \
  https://api.shortly.app/v1/links
```

**Rate Limits**:
- Professional: 5,000 requests/month
- Business: 50,000 requests/month
- Overage: Add-on available

**SDK Support** (Future):
- JavaScript/TypeScript
- Python
- PHP
- Ruby
- Go

**Use Cases**:
- Automated link generation
- Integration with CMS
- Bulk operations
- Custom dashboards
- Third-party tools

---

### 6. White-label Dashboard (Business Only)

**What it is**: Fully branded Shortly instance on your domain

**Features**:
- Custom domain (e.g., `links.yourbrand.com`)
- Your logo and brand colors
- Custom email templates
- Remove all Shortly branding
- Custom support links
- White-labeled documentation

**Implementation**:
```typescript
// White-label configuration
interface WhiteLabelConfig {
  domain: string
  logoUrl: string
  primaryColor: string
  secondaryColor: string
  companyName: string
  supportEmail: string
  supportUrl: string
  favicon: string
  customCSS?: string
}
```

**Use Cases**:
- Agencies offering link management to clients
- Enterprises with strict branding requirements
- White-label resellers
- SaaS products embedding link shortening

---

### 7. SSO/SAML Authentication (Business Only)

**What it is**: Enterprise identity management integration

**Supported Providers**:
- Okta
- Azure Active Directory
- Google Workspace
- OneLogin
- Auth0
- Custom SAML 2.0 providers

**Benefits**:
- Centralized user management
- Enhanced security
- Simplified onboarding/offboarding
- Compliance requirements
- Single sign-on experience

**Setup Process**:
1. Provide SAML metadata URL or XML
2. Configure attribute mapping
3. Test SSO connection
4. Enable for team members
5. Enforce SSO (optional)

---

### 8. Geographic Redirects (Business Only)

**What it is**: Route users to different URLs based on their location

**Features**:
- Country-level targeting
- Region/state targeting
- City-level targeting (major cities)
- Default fallback URL
- Multiple geographic rules per link

**Use Cases**:
- International campaigns
- Region-specific offers
- Language-specific landing pages
- Geo-restricted content
- Local store finders

**Example**:
```typescript
// Geographic redirect rules
geoRules: {
  linkId: 'abc123',
  rules: [
    { country: 'US', url: 'https://example.com/us' },
    { country: 'UK', url: 'https://example.com/uk' },
    { country: 'DE', url: 'https://example.com/de' },
    { default: true, url: 'https://example.com' }
  ]
}
```

**IP Geolocation**: Using MaxMind GeoIP2 or IPinfo

---

### 9. Password-Protected Links (Business Only)

**What it is**: Secure links with password authentication

**Features**:
- Set password per link
- Custom password prompt page
- Expiring passwords (optional)
- Failed attempt tracking
- IP-based rate limiting

**Use Cases**:
- Private content sharing
- Client-only resources
- Internal documents
- Beta access links
- Exclusive content

**Implementation**:
```typescript
// Password protection
linkPasswords: {
  linkId: string
  passwordHash: string // bcrypt
  expiresAt?: Date
  maxAttempts?: number
  failedAttempts: number
  lastAttemptAt?: Date
}
```

---

## ğŸ› ï¸ Implementation Guide

### Phase 1: Database Schema Updates

**Add Subscriptions Table**:
```typescript
subscriptions: {
  id: string (PK)
  userId: string (FK to users)
  tier: 'free' | 'starter' | 'professional' | 'business'
  status: 'active' | 'cancelled' | 'past_due' | 'trialing'
  currentPeriodStart: Date
  currentPeriodEnd: Date
  cancelAtPeriodEnd: boolean
  trialStart?: Date
  trialEnd?: Date
  stripeCustomerId: string
  stripeSubscriptionId: string
  stripePriceId: string
  createdAt: Date
  updatedAt: Date
}
```

**Add Usage Tracking Table**:
```typescript
usage: {
  id: string (PK)
  userId: string (FK)
  period: string // 'YYYY-MM' format
  linksCreated: number
  clicksTracked: number
  qrCodesGenerated: number
  customAliasesUsed: number
  apiRequests: number
  createdAt: Date
  updatedAt: Date
}
```

**Update Links Table**:
```typescript
links: {
  // ... existing fields
  password?: string // Business tier
  passwordHash?: string // bcrypt hash
  notes?: string // Starter+ tier
  tags?: string[] // Professional+ tier
  domainId?: string // Professional+ tier (FK to domains)
  folderId?: string // Professional+ tier
}
```

**Add Custom Domains Table**:
```typescript
domains: {
  id: string (PK)
  userId: string (FK)
  domain: string // e.g., "go.company.com"
  verified: boolean
  verificationToken: string
  sslEnabled: boolean
  createdAt: Date
  verifiedAt?: Date
  lastChecked?: Date
}
```

**Add Team Members Table**:
```typescript
teamMembers: {
  id: string (PK)
  teamId: string // subscription.id
  userId: string
  role: 'owner' | 'admin' | 'editor' | 'viewer'
  invitedBy: string
  invitedAt: Date
  joinedAt?: Date
  lastActive?: Date
}
```

**Add API Keys Table**:
```typescript
apiKeys: {
  id: string (PK)
  userId: string (FK)
  name: string
  keyHash: string // hashed API key
  keyPrefix: string // e.g., "sk_live_abc"
  lastUsedAt?: Date
  expiresAt?: Date
  rateLimit: number // requests per month
  createdAt: Date
  revokedAt?: Date
}
```

---

### Phase 2: Stripe Integration

**Install Dependencies**:
```bash
pnpm add stripe @stripe/stripe-js
```

**Create Stripe Products & Prices**:
```typescript
// Stripe Dashboard or API
products: [
  {
    name: "Shortly Starter",
    prices: [
      { amount: 900, currency: "usd", interval: "month" },
      { amount: 9000, currency: "usd", interval: "year" }
    ]
  },
  {
    name: "Shortly Professional",
    prices: [
      { amount: 2900, currency: "usd", interval: "month" },
      { amount: 29000, currency: "usd", interval: "year" }
    ]
  },
  {
    name: "Shortly Business",
    prices: [
      { amount: 9900, currency: "usd", interval: "month" },
      { amount: 99000, currency: "usd", interval: "year" }
    ]
  }
]
```

**Webhook Handlers**:
```typescript
// app/api/webhooks/stripe/route.ts
import { stripe } from '@/lib/stripe';
import { db } from '@/db';

export async function POST(req: Request) {
  const body = await req.text();
  const sig = req.headers.get('stripe-signature');
  
  const event = stripe.webhooks.constructEvent(
    body,
    sig,
    process.env.STRIPE_WEBHOOK_SECRET
  );
  
  switch (event.type) {
    case 'customer.subscription.created':
      await handleSubscriptionCreated(event.data.object);
      break;
    case 'customer.subscription.updated':
      await handleSubscriptionUpdated(event.data.object);
      break;
    case 'customer.subscription.deleted':
      await handleSubscriptionDeleted(event.data.object);
      break;
    case 'invoice.payment_succeeded':
      await handlePaymentSucceeded(event.data.object);
      break;
    case 'invoice.payment_failed':
      await handlePaymentFailed(event.data.object);
      break;
  }
  
  return Response.json({ received: true });
}
```

**Checkout Flow**:
```typescript
// app/api/checkout/route.ts
import { stripe } from '@/lib/stripe';
import { currentUser } from '@clerk/nextjs';

export async function POST(req: Request) {
  const user = await currentUser();
  const { priceId, successUrl, cancelUrl } = await req.json();
  
  const session = await stripe.checkout.sessions.create({
    customer_email: user.emailAddresses[0].emailAddress,
    line_items: [{ price: priceId, quantity: 1 }],
    mode: 'subscription',
    success_url: successUrl,
    cancel_url: cancelUrl,
    metadata: { userId: user.id }
  });
  
  return Response.json({ url: session.url });
}
```

---

### Phase 3: Feature Gating Middleware

**Usage Limits Check**:
```typescript
// lib/subscription.ts
import { db } from '@/db';

const PLAN_LIMITS = {
  free: {
    maxLinks: 25,
    maxClicksPerMonth: 1000,
    maxCustomAliasesPerMonth: 5,
    maxQRCodesPerMonth: 3,
    analyticsRetentionDays: 30,
    features: ['basic_analytics', 'link_expiration']
  },
  starter: {
    maxLinks: 200,
    maxClicksPerMonth: 10000,
    maxCustomAliasesPerMonth: Infinity,
    maxQRCodesPerMonth: 25,
    analyticsRetentionDays: 90,
    features: ['basic_analytics', 'advanced_analytics', 'bulk_import']
  },
  professional: {
    maxLinks: 1000,
    maxClicksPerMonth: 100000,
    maxCustomAliasesPerMonth: Infinity,
    maxQRCodesPerMonth: 100,
    analyticsRetentionDays: 365,
    maxTeamMembers: 3,
    maxCustomDomains: 1,
    maxApiRequests: 5000,
    features: ['custom_domains', 'branded_qr', 'ab_testing', 'api_access']
  },
  business: {
    maxLinks: Infinity,
    maxClicksPerMonth: Infinity,
    maxCustomAliasesPerMonth: Infinity,
    maxQRCodesPerMonth: Infinity,
    analyticsRetentionDays: Infinity,
    maxTeamMembers: 10,
    maxCustomDomains: 5,
    maxApiRequests: 50000,
    features: ['white_label', 'sso', 'geo_redirects', 'password_protection']
  }
};

export async function checkLimit(
  userId: string,
  resource: string
): Promise<{ allowed: boolean; limit: number; current: number }> {
  const subscription = await db.query.subscriptions.findFirst({
    where: eq(subscriptions.userId, userId)
  });
  
  const tier = subscription?.tier || 'free';
  const limits = PLAN_LIMITS[tier];
  
  // Get current usage
  const usage = await getCurrentUsage(userId, resource);
  const limit = limits[resource];
  
  return {
    allowed: usage < limit,
    limit,
    current: usage
  };
}

export function hasFeature(tier: string, feature: string): boolean {
  return PLAN_LIMITS[tier]?.features?.includes(feature) || false;
}
```

**Middleware for Protected Features**:
```typescript
// middleware/require-feature.ts
export function requireFeature(feature: string) {
  return async (userId: string) => {
    const subscription = await getSubscription(userId);
    const tier = subscription?.tier || 'free';
    
    if (!hasFeature(tier, feature)) {
      throw new Error(`Feature '${feature}' requires upgrade to ${getRequiredTier(feature)}`);
    }
  };
}

// Usage in actions
export async function createCustomDomain(domain: string) {
  await requireFeature('custom_domains')(userId);
  // ... proceed with domain creation
}
```

---

### Phase 4: Subscription Management UI

**Pricing Page Component**:
```typescript
// components/pricing-tiers.tsx
export function PricingTiers() {
  const tiers = [
    {
      name: 'Free',
      price: 0,
      features: ['25 links', '1K clicks/mo', 'Basic analytics']
    },
    // ... other tiers
  ];
  
  return (
    <div className="grid md:grid-cols-4 gap-8">
      {tiers.map(tier => (
        <PricingCard key={tier.name} {...tier} />
      ))}
    </div>
  );
}
```

**Subscription Management Page**:
```typescript
// app/dashboard/billing/page.tsx
export default async function BillingPage() {
  const user = await currentUser();
  const subscription = await getSubscription(user.id);
  const usage = await getCurrentPeriodUsage(user.id);
  
  return (
    <div>
      <CurrentPlanCard subscription={subscription} />
      <UsageMetrics usage={usage} limits={PLAN_LIMITS[subscription.tier]} />
      <BillingHistory />
      <UpgradeOptions />
    </div>
  );
}
```

---

### Phase 5: Usage Metering

**Track Usage in Real-time**:
```typescript
// lib/usage-tracking.ts
export async function trackUsage(
  userId: string,
  metric: 'links' | 'clicks' | 'qr_codes' | 'custom_aliases' | 'api_requests',
  amount: number = 1
) {
  const period = new Date().toISOString().slice(0, 7); // YYYY-MM
  
  await db.insert(usage)
    .values({
      userId,
      period,
      [metric]: amount
    })
    .onConflictDoUpdate({
      target: [usage.userId, usage.period],
      set: { [metric]: sql`${usage[metric]} + ${amount}` }
    });
}

// Usage in link creation
export async function createLink(data) {
  // Check limit
  const { allowed } = await checkLimit(userId, 'maxLinks');
  if (!allowed) {
    throw new UpgradeRequiredError('Link limit reached');
  }
  
  // Create link
  const link = await db.insert(links).values(data);
  
  // Track usage
  await trackUsage(userId, 'links', 1);
  
  return link;
}
```

**Usage Alerts**:
```typescript
// Send email when approaching limit (80%, 90%, 100%)
export async function checkUsageAlerts(userId: string) {
  const usage = await getCurrentUsage(userId);
  const limits = await getUserLimits(userId);
  
  for (const [metric, current] of Object.entries(usage)) {
    const limit = limits[metric];
    const percent = (current / limit) * 100;
    
    if (percent >= 80 && !hasAlertBeenSent(userId, metric, 80)) {
      await sendUsageAlert(userId, metric, percent);
    }
  }
}
```

---

## ğŸ“Š Competitive Analysis

### Market Comparison

| Provider | Free Plan | Entry Paid | Mid Tier | High Tier |
|----------|-----------|------------|----------|-----------|
| **Shortly** | 25 links, 1K clicks | $9/mo (200 links) | $29/mo (1K links, custom domain) | $99/mo (unlimited) |
| **Bitly** | 5 links | $10/mo (100 links) | $35/mo (500 links) | $300/mo (3K links) |
| **Rebrandly** | 5 links | $24/yr (25 links) | $416/yr (500 links) | $999/yr (5K links) |
| **TinyURL** | 100 links | $12.99/mo | - | $129/mo (100K links) |
| **Short.io** | 1K clicks | $20/mo (10K clicks) | $50/mo (50K clicks) | $150/mo (200K clicks) |

### Shortly's Competitive Advantages

**1. Better Free Tier**:
- Shortly: 25 links vs Bitly's 5
- More generous click limits
- More features included (expiration, scheduling)

**2. More Affordable Paid Plans**:
- Starter at $9 vs Bitly Core at $10
- Professional at $29 vs Bitly Growth at $35
- Better value at every tier

**3. Unique Features**:
- âœ… **Link activation scheduling** (not available elsewhere)
- âœ… **Modern tech stack** (faster redirects)
- âœ… **Better analytics retention** (1 year vs 30 days at comparable tiers)
- âœ… **Transparent pricing** (no hidden fees)

**4. Developer-Friendly**:
- API access at Professional tier (vs Business tier for competitors)
- Better API rate limits
- Modern REST API
- Comprehensive documentation

**5. Better QR Code Features**:
- More QR codes per tier
- Branded QR codes at Professional (vs Business at competitors)
- More customization options

### Market Positioning

**Target Positioning**: "The modern, developer-friendly link shortener for teams who value transparency and fair pricing"

**Key Messages**:
1. "More features, better pricing than Bitly"
2. "Built for modern teams with modern technology"
3. "No vendor lock-in - export your data anytime"
4. "Fair limits that grow with your business"

**Target Segments**:
- **Free**: Individual users frustrated with Bitly's 5-link limit
- **Starter**: Freelancers and content creators needing unlimited aliases
- **Professional**: Growing businesses wanting custom domains without enterprise pricing
- **Business**: Agencies and enterprises needing white-label and SSO

---

## ğŸ’¡ Monetization Strategy

### Conversion Funnel

**Stage 1: Free User Acquisition**
- Goal: 10,000 free users in Year 1
- Channels: SEO, content marketing, developer communities
- Activation: Get users to create their first 3 links

**Stage 2: Free to Paid Conversion**
- Target: 5-10% conversion rate
- Triggers:
  - Hit 25 link limit
  - Need custom aliases
  - Want advanced analytics
  - Require team collaboration
- Tactics:
  - In-app upgrade prompts
  - Usage alerts at 80%
  - Feature discovery tours
  - Limited-time offers

**Stage 3: Paid Tier Upgrades**
- Target: 15-20% upgrade rate (Starter â†’ Pro)
- Triggers:
  - Need custom domain
  - Want API access
  - Require team features
  - Need higher limits
- Tactics:
  - Feature showcases
  - Use case education
  - ROI calculators
  - Free trials of higher tiers

**Stage 4: Revenue Expansion**
- Add-ons (extra domains, team members)
- Annual upgrades (17% discount incentive)
- Enterprise custom plans
- Professional services

### Pricing Psychology

**1. Anchor Pricing**:
- Show annual savings (17% off, "Save $198/year")
- Display Business tier to make Professional seem affordable
- Emphasize value over cost

**2. Feature-based Differentiation**:
- Each tier adds meaningful capabilities
- Not just "more of the same"
- Clear upgrade path

**3. Usage-based Fairness**:
- Pay for what you use
- Scale up or down easily
- No penalty for growth

**4. Trial Strategy**:
- 14-day free trial for all paid tiers
- No credit card required for Free tier
- Full access during trial
- Gentle reminders before trial ends

### Revenue Projections

**Year 1 Targets**:
- Free users: 10,000
- Starter: 500 (5% conversion) = $4,500/mo
- Professional: 75 (15% of paid) = $2,175/mo
- Business: 10 (2% of paid) = $990/mo
- **Total MRR**: $7,665
- **Annual Revenue**: ~$92,000

**Year 2 Targets**:
- Free users: 50,000
- Starter: 2,500 (5%) = $22,500/mo
- Professional: 400 (16%) = $11,600/mo
- Business: 50 (2%) = $4,950/mo
- **Total MRR**: $39,050
- **Annual Revenue**: ~$469,000

**Year 3 Targets**:
- Free users: 200,000
- Paid users: 10,000+ (5%)
- **Target ARR**: $1.5M - $2M

### Key Metrics to Track

**Acquisition Metrics**:
- Signups per day/week/month
- Traffic sources
- Conversion rate (visitor â†’ signup)
- Activation rate (signup â†’ first link)

**Revenue Metrics**:
- MRR (Monthly Recurring Revenue)
- ARR (Annual Recurring Revenue)
- ARPU (Average Revenue Per User)
- LTV (Lifetime Value)
- CAC (Customer Acquisition Cost)
- LTV:CAC ratio (target: 3:1)

**Conversion Metrics**:
- Free â†’ Paid conversion rate (target: 5-10%)
- Trial â†’ Paid conversion rate (target: 25-40%)
- Monthly â†’ Annual upgrade rate (target: 30%)
- Tier upgrade rate (target: 15-20%)

**Retention Metrics**:
- Monthly churn rate (target: <5%)
- Net Revenue Retention (target: >100%)
- Cohort retention curves
- Reactivation rate

**Product Metrics**:
- Links created per user
- Clicks per link
- Feature adoption rates
- API usage growth
- Support ticket volume

---

## ğŸ“ˆ Growth & Marketing

### Marketing Channels

**1. SEO & Content Marketing**:
- Blog posts: "How to track link performance"
- Comparison pages: "Bitly vs Shortly"
- Use case guides: "Link shortening for agencies"
- Developer tutorials
- API documentation SEO

**2. Product Hunt Launch**:
- Launch day: Special lifetime deals
- Community engagement
- Upvote campaigns
- Founder stories

**3. Developer Communities**:
- GitHub sponsorships
- Dev.to articles
- Reddit communities (r/webdev, r/marketing)
- Hacker News posts
- Twitter developer communities

**4. Affiliate Program**:
- 20% recurring commission
- 60-day cookie window
- Affiliate dashboard
- Marketing materials provided
- Top affiliate bonuses

**5. Partnerships**:
- Integration with marketing tools
- CMS plugins (WordPress, Webflow)
- Social media management tools
- Email marketing platforms
- Analytics tools

### Growth Tactics

**Viral Features**:
- Public link pages (showcase your links)
- Referral program (get credits for invites)
- "Powered by Shortly" on QR codes (Free tier)
- Social sharing of analytics

**Product-Led Growth**:
- No credit card for Free tier
- Instant value (create link in 30 seconds)
- Shareable short links spread awareness
- API-first approach (developers love it)

**Community Building**:
- Discord community
- Feature request voting
- User showcase (best use cases)
- Case studies and testimonials
- User-generated content

**Email Sequences**:
- Welcome series (onboarding)
- Feature discovery emails
- Usage milestone celebrations
- Re-engagement campaigns
- Upgrade opportunity emails

### Retention Strategies

**Onboarding Excellence**:
- Interactive product tours
- Quick-start guides
- Video tutorials
- Use case templates
- Success checklists

**Continuous Value Delivery**:
- Weekly analytics emails
- Monthly usage reports
- Feature announcements
- Tips and best practices
- Industry benchmarks

**Customer Success**:
- Proactive support
- Health score monitoring
- Usage pattern analysis
- Check-in calls (Business tier)
- Quarterly business reviews

**Feedback Loops**:
- NPS surveys
- Feature request portal
- Beta testing programs
- User interviews
- Feedback incorporation

---

## â“ FAQ

### General Questions

**Q: Can I change plans anytime?**  
A: Yes! Upgrade or downgrade anytime. Upgrades take effect immediately. Downgrades take effect at the end of your current billing period.

**Q: What happens if I exceed my plan limits?**  
A: We'll send you alerts at 80% and 90% usage. At 100%, you'll be prompted to upgrade or purchase add-ons. Your existing links will continue working.

**Q: Do you offer refunds?**  
A: Yes, we offer a 14-day money-back guarantee on all annual plans. Monthly plans are non-refundable but you can cancel anytime.

**Q: Can I try paid features before upgrading?**  
A: Yes! All paid tiers include a 14-day free trial with full access to all features.

**Q: Is there a setup fee?**  
A: No setup fees, no hidden costs. What you see is what you pay.

### Billing Questions

**Q: What payment methods do you accept?**  
A: We accept all major credit cards (Visa, Mastercard, Amex, Discover) via Stripe.

**Q: Can I pay annually?**  
A: Yes! Annual plans save 17% (equivalent to 2 months free).

**Q: Do you offer discounts for nonprofits or education?**  
A: Yes! We offer 30% off all paid plans for registered nonprofits and educational institutions. Contact sales for verification.

**Q: Can I get an invoice for my subscription?**  
A: Yes, invoices are automatically generated and emailed for each payment.

### Feature Questions

**Q: Can I use my own domain?**  
A: Yes, with Professional or Business plans. You'll need to configure DNS records which we'll guide you through.

**Q: Is there a limit on link redirects (clicks)?**  
A: Click limits only affect tracking/analytics. Your links always work. If you exceed tracking limits, additional clicks aren't tracked but still redirect properly.

**Q: Can I export my data?**  
A: Yes! All tiers can export links to CSV. Professional and Business can export to JSON and Excel with full analytics data.

**Q: What happens to my links if I downgrade?**  
A: All links continue working. You'll need to reduce your active links to fit the new plan's limit (we'll help you archive extras).

**Q: Do deleted links stop working?**  
A: Yes, deleted links immediately return a 404 error. Consider deactivating instead if you might reuse them.

### Team Questions

**Q: Can I add more team members than my plan includes?**  
A: Yes! Additional team members are $9/month each for Professional and Business plans.

**Q: Can team members have different permission levels?**  
A: Yes, we offer four roles: Owner, Admin, Editor, and Viewer with different access levels.

**Q: Can I transfer ownership of my account?**  
A: Yes, account owners can transfer ownership to another team member.

### Security Questions

**Q: Is my data secure?**  
A: Yes! All data is encrypted in transit (SSL/TLS) and at rest. We follow industry best practices for security.

**Q: Do you sell or share my data?**  
A: Never. Your data is yours. We don't sell or share any user data with third parties.

**Q: Can I delete my account and data?**  
A: Yes, you can delete your account anytime from settings. This permanently deletes all your data.

**Q: Do you offer SOC 2 compliance?**  
A: We're working towards SOC 2 Type II certification. Business plans will include compliance documentation when available.

### Support Questions

**Q: What support do you offer?**  
A: Free tier gets community support (docs, forums). Paid tiers get email support with response times based on tier. Business plans get phone and chat support.

**Q: Do you offer custom development?**  
A: Yes! Business plans can request custom features. Contact your account manager for pricing.

**Q: Can you help with migration from another service?**  
A: Yes! We offer free migration assistance for Professional and Business plans. We can help import your links from Bitly, Rebrandly, or any CSV file.

---

## ğŸ¯ Next Steps

### For Implementation

1. **Review this pricing strategy** with stakeholders
2. **Set up Stripe account** and create products
3. **Implement database schema** changes
4. **Build subscription management** UI
5. **Create pricing page** with tier comparison
6. **Develop feature gating** middleware
7. **Test payment flows** thoroughly
8. **Set up webhooks** and test all scenarios
9. **Create documentation** for users
10. **Launch with marketing** campaign

### For Marketing

1. **Create comparison content** (Shortly vs Bitly)
2. **Build landing pages** for each tier
3. **Develop email sequences** for onboarding/conversion
4. **Set up analytics** tracking
5. **Create promotional materials**
6. **Plan Product Hunt** launch
7. **Build affiliate program**
8. **Engage developer communities**

### For Support

1. **Create help center** articles
2. **Build FAQ section**
3. **Set up support ticketing** system
4. **Train support team** on all tiers
5. **Create upgrade guides** for users
6. **Develop troubleshooting** resources

---

**Pricing optimized for: User acquisition, Revenue growth, Competitive positioning, Long-term sustainability**
